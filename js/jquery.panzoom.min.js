(function(b,a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(b.jQuery)}}(this,function(c){var b={props:["touches","pageX","pageY"],filter:function(p,o){var q;if(!o.pageX&&o.touches&&(q=o.touches[0])){p.pageX=q.pageX;p.pageY=q.pageY}return p}};c.each(["touchstart","touchmove","touchend"],function(p,o){c.event.fixHooks[o]=b});var d="__pz__";var l=Array.prototype.slice;var m=/([A-Z])/g;var j=/^http:[\w\.\/]+svg$/;var f=/^inline/;var i="(\\-?[\\d\\.e]+)";var n="\\,?\\s*";var h=new RegExp("^matrix\\("+i+n+i+n+i+n+i+n+i+n+i+"\\)$");function k(p){var o={range:true,animate:true};if(typeof p==="boolean"){o.animate=p}else{c.extend(o,p)}return o}function a(w,v,u,t,s,r,q,p,o){if(c.type(w)==="array"){this.elements=[+w[0],+w[2],+w[4],+w[1],+w[3],+w[5],0,0,1]}else{this.elements=[w,v,u,t,s,r,q||0,p||0,o||1]}}a.prototype={x:function(q){var r=q instanceof e;var p=this.elements,o=q.elements;if(r&&o.length===3){return new e(p[0]*o[0]+p[1]*o[1]+p[2]*o[2],p[3]*o[0]+p[4]*o[1]+p[5]*o[2],p[6]*o[0]+p[7]*o[1]+p[8]*o[2])}else{if(o.length===p.length){return new a(p[0]*o[0]+p[1]*o[3]+p[2]*o[6],p[0]*o[1]+p[1]*o[4]+p[2]*o[7],p[0]*o[2]+p[1]*o[5]+p[2]*o[8],p[3]*o[0]+p[4]*o[3]+p[5]*o[6],p[3]*o[1]+p[4]*o[4]+p[5]*o[7],p[3]*o[2]+p[4]*o[5]+p[5]*o[8],p[6]*o[0]+p[7]*o[3]+p[8]*o[6],p[6]*o[1]+p[7]*o[4]+p[8]*o[7],p[6]*o[2]+p[7]*o[5]+p[8]*o[8])}}return false},inverse:function(){var p=1/this.determinant(),o=this.elements;return new a(p*(o[8]*o[4]-o[7]*o[5]),p*(-(o[8]*o[1]-o[7]*o[2])),p*(o[5]*o[1]-o[4]*o[2]),p*(-(o[8]*o[3]-o[6]*o[5])),p*(o[8]*o[0]-o[6]*o[2]),p*(-(o[5]*o[0]-o[3]*o[2])),p*(o[7]*o[3]-o[6]*o[4]),p*(-(o[7]*o[0]-o[6]*o[1])),p*(o[4]*o[0]-o[3]*o[1]))},determinant:function(){var o=this.elements;return o[0]*(o[8]*o[4]-o[7]*o[5])-o[3]*(o[8]*o[1]-o[7]*o[2])+o[6]*(o[5]*o[1]-o[4]*o[2])}};function e(o,q,p){this.elements=[o,q,p]}e.prototype.e=a.prototype.e=function(o){return this.elements[o]};function g(s,q){if(s.nodeType!==1){c.error("Panzoom called on non-Element node")}if(!c.contains(document,s)){c.error("Panzoom element must be attached to the document")}var t=c.data(s,d);if(t){return t}if(!(this instanceof g)){return new g(s,q)}this.options=q=c.extend({},g.defaults,q);this.elem=s;var p=this.$elem=c(s);this.$doc=c(s.ownerDocument||document);this.$parent=p.parent();this.isSVG=j.test(s.namespaceURI)&&s.nodeName.toLowerCase()!=="svg";this.panning=false;this._buildTransform();if(!this.isSVG){this._transform=c.cssProps.transform.replace(m,"-$1").toLowerCase()}this._buildTransition();this._buildContain();var r=c();var o=this;c.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(v,u){o[u]=q[u]||r});this.enable();c.data(s,d,this)}g.rmatrix=h;g.defaults={eventNamespace:".panzoom",transition:true,cursor:"move",disablePan:false,disableZoom:false,increment:0.3,minScale:0.4,maxScale:5,rangeStep:0.05,duration:200,easing:"ease-in-out",contain:false};g.prototype={constructor:g,instance:function(){return this},enable:function(){this._initStyle();this._bind();this.disabled=false},disable:function(){this.disabled=true;this._resetStyle();this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable();c.removeData(this.elem,d)},reset:function(p){p=k(p);var o=this.setMatrix(this._origTransform,p);if(!p.silent){this._trigger("reset",o)}},resetZoom:function(p){p=k(p);var o=this.getMatrix(this._origTransform);p.dValue=o[3];this.zoom(o[0],p)},resetPan:function(p){var o=this.getMatrix(this._origTransform);this.pan(o[4],o[5],k(p))},getTransform:function(o){var p=this.elem;var q=this.isSVG?"attr":"style";if(o){c[q](p,"transform",o)}else{o=c[q](p,"transform")}if(o!=="none"&&!h.test(o)&&!this.isSVG){o=c.css(p,"transform");c.style(p,"transform",o)}return o||"none"},getMatrix:function(p){var o=h.exec(p||this.getTransform());if(o){o.shift()}return o||[1,0,0,1,0,0]},setMatrix:function(v,z){if(this.disabled){return}if(!z){z={}}if(typeof v==="string"){v=this.getMatrix(v)}var w,o,y,t,x,s;var q=+v[0];var r=this.$parent;var p=this.elem;var u=typeof z.contain!=="undefined"?z.contain:this.options.contain;if(u){w=this._checkDims();o=this.container;y=((w.width*q)-o.width)/2;t=((w.height*q)-o.height)/2;if(u==="invert"){x=w.width>o.width?w.width-o.width:0;s=w.height>o.height?w.height-o.height:0;y+=(o.width-w.width)/2;t+=(o.height-w.height)/2;v[4]=Math.max(Math.min(v[4],y-w.left),-y-w.left-x);v[5]=Math.max(Math.min(v[5],t-w.top),-t-w.top-s+w.heightBorder)}else{s=o.height>w.height?o.height-w.height:0;if(r.css("textAlign")!=="center"||!f.test(c.css(p,"display"))){x=o.width>w.width?o.width-w.width:0;y=t=0}else{x=0}v[4]=Math.min(Math.max(v[4],y-w.left),-y-w.left+x);v[5]=Math.min(Math.max(v[5],t-w.top),-t-w.top+s)}}if(z.animate!=="skip"){this.transition(!z.animate)}if(z.range){this.$zoomRange.val(q)}c[this.isSVG?"attr":"style"](p,"transform","matrix("+v.join(",")+")");if(!z.silent){this._trigger("change",v)}return v},isPanning:function(){return this.panning},transition:function(p){var o=p||!this.options.transition?"none":this._transition;if(c.style(this.elem,"transition")!==o){c.style(this.elem,"transition",o)}},pan:function(o,r,q){if(this.options.disablePan){return}if(!q){q={}}var p=q.matrix;if(!p){p=this.getMatrix()}if(q.relative){p[4]=+p[4]+o;p[5]=+p[5]+r}else{p[4]=o;p[5]=r}this.setMatrix(p,q);if(!q.silent){this._trigger("pan",o,r)}},zoom:function(x,p){if(typeof x==="object"){p=x;x=null}else{if(!p){p={}}}var D=c.extend({},this.options,p);if(D.disableZoom){return}var t=false;var B=D.matrix||this.getMatrix();if(typeof x!=="number"){x=+B[0]+(D.increment*(x?-1:1));t=true}if(x>D.maxScale){x=D.maxScale}else{if(x<D.minScale){x=D.minScale}}var w=D.focal;if(w&&!D.disablePan){t=false;var r=this.container;var s=w.clientX-r.width/2;var q=w.clientY-r.height/2;var v=new e(s,q,1);var z=new a(B);var u=this.$parent.offset();var C=new a(1,0,u.left-this.$doc.scrollLeft(),0,1,u.top-this.$doc.scrollTop());var y=z.inverse().x(C.inverse().x(v));var A=x/B[0];z=z.x(new a([A,0,0,A,0,0]));v=C.x(z.x(y));B[4]=+B[4]+(s-v.e(0));B[5]=+B[5]+(q-v.e(1))}B[0]=x;B[3]=typeof D.dValue==="number"?D.dValue:x;this.setMatrix(B,{animate:typeof D.animate==="boolean"?D.animate:t,range:!D.noSetRange});if(!D.silent){this._trigger("zoom",x,D)}},option:function(p,q){var o;if(!p){return c.extend({},this.options)}if(typeof p==="string"){if(arguments.length===1){return this.options[p]!==undefined?this.options[p]:null}o={};o[p]=q}else{o=p}this._setOptions(o)},_setOptions:function(p){var o=this;c.each(p,function(q,r){switch(q){case"disablePan":o._resetStyle();case"disableZoom":case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":o._unbind()}o.options[q]=r;switch(q){case"disablePan":o._initStyle();case"disableZoom":case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":o._bind();break;case"cursor":c.style(o.elem,"cursor",r);break;case"minScale":o.$zoomRange.attr("min",r);break;case"maxScale":o.$zoomRange.attr("max",r);break;case"rangeStep":o.$zoomRange.attr("step",r);break;case"startTransform":o._buildTransform();break;case"duration":case"easing":o._buildTransition();case"transition":o.transition()}})},_initStyle:function(){if(!this.options.disablePan){this.$elem.css("cursor",this.options.cursor)}var o=this.$parent;if(o.length&&!c.nodeName(o[0],"body")){var p={overflow:"hidden"};if(o.css("position")==="static"){p.position="relative"}o.css(p)}},_resetStyle:function(){this.$elem.css({cursor:"",transition:""});this.$parent.css({overflow:"",position:""})},_bind:function(){var w=this;var x=this.options;var r=x.eventNamespace;var u="touchstart"+r+" mousedown"+r;var s="touchend"+r+" click"+r;var v={};var p=this.$reset;var q=this.$zoomRange;c.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var y=x["on"+this];if(c.isFunction(y)){v["panzoom"+this.toLowerCase()+r]=y}});if(!x.disablePan||!x.disableZoom){v[u]=function(z){var y;if(z.type==="mousedown"?!x.disablePan&&z.which===1:(y=z.touches)&&((y.length===1&&!x.disablePan)||y.length===2)){z.preventDefault();z.stopPropagation();w._startMove(z,y)}}}this.$elem.on(v);if(p.length){p.on(s,function(y){y.preventDefault();w.reset()})}if(q.length){q.attr({step:x.rangeStep===g.defaults.rangeStep&&q.attr("step")||x.rangeStep,min:x.minScale,max:x.maxScale}).prop({value:this.getMatrix()[0]})}if(x.disableZoom){return}var t=this.$zoomIn;var o=this.$zoomOut;if(t.length&&o.length){t.on(s,function(y){y.preventDefault();w.zoom()});o.on(s,function(y){y.preventDefault();w.zoom(true)})}if(q.length){v={};v["mousedown"+r]=function(){w.transition(true)};v["change"+r]=function(){w.zoom(+this.value,{noSetRange:true})};q.on(v)}},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){var o=this.options;if(this._transform){this._transition=this._transform+" "+o.duration+"ms "+o.easing}},_buildContain:function(){var q=this.$parent;this.container={width:q.width(),height:q.height()};var p=this.elem;var o=this.$elem;var r=this.dimensions=this.isSVG?{left:p.getAttribute("x")||0,top:p.getAttribute("y")||0,width:p.getAttribute("width")||o.outerWidth(),height:p.getAttribute("height")||o.outerHeight()}:{left:c.css(p,"left",true)||0,top:c.css(p,"top",true)||0,width:o.outerWidth(),height:o.outerHeight()};r.widthBorder=(c.css(p,"borderLeftWidth",true)+c.css(p,"borderRightWidth",true))||0;r.heightBorder=(c.css(p,"borderTopWidth",true)+c.css(p,"borderBottomWidth",true))||0},_checkDims:function(){var o=this.dimensions;if(o.width===o.widthBorder||o.height===o.heightBorder){this._buildContain()}return this.dimensions},_getDistance:function(q){var p=q[0];var o=q[1];return Math.sqrt(Math.pow(Math.abs(o.clientX-p.clientX),2)+Math.pow(Math.abs(o.clientY-p.clientY),2))},_getMiddle:function(q){var p=q[0];var o=q[1];return{clientX:((o.clientX-p.clientX)/2)+p.clientX,clientY:((o.clientY-p.clientY)/2)+p.clientY}},_trigger:function(o){this.$elem.triggerHandler("panzoom"+o,[this].concat(l.call(arguments,1)))},_startMove:function(A,t){var w,x,B,s,E,D;var v=this;var q=this.options;var r=A.type==="touchstart";var G=q.eventNamespace;var o=(r?"touchmove":"mousemove")+G;var u=(r?"touchend":"mouseup")+G;var z=this.getMatrix();var y=z.slice(0);var F=+y[4];var C=+y[5];var p={matrix:z,animate:"skip"};this.transition(true);this.panning=true;this._trigger("start",A,t);if(t&&t.length===2){x=this._getDistance(t);B=+z[0];s=this._getMiddle(t);w=function(J){J.preventDefault();var H=v._getMiddle(t=J.touches);var I=v._getDistance(t)-x;v.zoom(I*(q.increment/100)+B,{focal:H,matrix:z});v.pan(+z[4]+H.clientX-s.clientX,+z[5]+H.clientY-s.clientY,p);s=H}}else{E=A.pageX;D=A.pageY;w=function(H){H.preventDefault();v.pan(F+H.pageX-E,C+H.pageY-D,p)}}c(document).off(G).on(o,w).on(u,function(H){H.preventDefault();c(this).off(G);v.panning=false;v._trigger("end",z,!!c(y).not(z).length)})}};c.fn.panzoom=function(s){var p,r,o,q;if(typeof s==="string"){q=[];r=l.call(arguments,1);this.each(function(){p=c.data(this,d);if(!p){q.push(undefined)}else{if(s.charAt(0)!=="_"&&typeof(o=p[s])==="function"&&(o=o.apply(p,r))!==undefined){q.push(o)}}});return q.length?(q.length===1?q[0]:q):this}return this.each(function(){new g(this,s)})};return g}));